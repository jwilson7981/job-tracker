{% extends "base.html" %}
{% block title %}Recurring Expenses - Construction Management{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Recurring Expenses</h1>
    <button class="btn btn-primary" onclick="showAddExpense()">+ Add Expense</button>
</div>

<!-- Summary Cards -->
<div class="kpi-grid" id="summaryCards">
    <div class="kpi-card" style="border-left-color: #EF4444;">
        <div class="kpi-value" id="sumMonthly">$0.00</div>
        <div class="kpi-label">Total Monthly Burn</div>
    </div>
    <div class="kpi-card" style="border-left-color: #F59E0B;">
        <div class="kpi-value" id="sumQuarterly">$0.00</div>
        <div class="kpi-label">Total Quarterly</div>
    </div>
    <div class="kpi-card" style="border-left-color: #3B82F6;">
        <div class="kpi-value" id="sumAnnual">$0.00</div>
        <div class="kpi-label">Total Annual</div>
    </div>
    <div class="kpi-card" id="nextDueCard" style="border-left-color: #22C55E;">
        <div class="kpi-value" id="sumNextDue">--</div>
        <div class="kpi-label">Next Due</div>
    </div>
</div>

<!-- Category Filter Tabs -->
<div class="tab-bar" id="categoryTabs">
    <button class="tab active" onclick="filterCategory('all', this)">All</button>
    <button class="tab" onclick="filterCategory('Insurance', this)">Insurance</button>
    <button class="tab" onclick="filterCategory('Utilities', this)">Utilities</button>
    <button class="tab" onclick="filterCategory('Rent/Lease', this)">Rent/Lease</button>
    <button class="tab" onclick="filterCategory('Vehicle', this)">Vehicle</button>
    <button class="tab" onclick="filterCategory('Subscriptions', this)">Subscriptions</button>
    <button class="tab" onclick="filterCategory('Other', this)">Other</button>
</div>

<!-- Expenses Table -->
<div class="module-table-wrapper" style="margin-top:16px;">
    <table class="data-table">
        <thead>
            <tr>
                <th>Category</th>
                <th>Vendor</th>
                <th>Description</th>
                <th>Amount</th>
                <th>Frequency</th>
                <th>Next Due</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="expensesBody">
            <tr><td colspan="8" class="loading">Loading...</td></tr>
        </tbody>
    </table>
</div>

<!-- Add/Edit Expense Modal -->
<div id="expenseModal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
    <div class="modal">
        <div class="modal-header">
            <h2 id="expenseModalTitle">Add Recurring Expense</h2>
            <button class="modal-close" onclick="document.getElementById('expenseModal').style.display='none'">&times;</button>
        </div>
        <form onsubmit="saveExpense(event)">
            <div class="form-group">
                <label class="form-label">Category</label>
                <select id="expCategory" class="form-select" required>
                    <option value="">Select category...</option>
                    <option value="Insurance">Insurance</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Rent/Lease">Rent/Lease</option>
                    <option value="Vehicle">Vehicle</option>
                    <option value="Subscriptions">Subscriptions</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Vendor</label>
                <input type="text" id="expVendor" class="form-input" required placeholder="e.g. State Farm, OG&E">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <input type="text" id="expDescription" class="form-input" placeholder="e.g. General Liability Insurance">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" id="expAmount" class="form-input" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Frequency</label>
                    <select id="expFrequency" class="form-select" required>
                        <option value="Weekly">Weekly</option>
                        <option value="Bi-Weekly">Bi-Weekly</option>
                        <option value="Monthly" selected>Monthly</option>
                        <option value="Quarterly">Quarterly</option>
                        <option value="Annual">Annual</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Due Day (of month)</label>
                    <input type="number" id="expDueDay" class="form-input" min="1" max="31" placeholder="1-31">
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input type="date" id="expStartDate" class="form-input">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">End Date (optional)</label>
                    <input type="date" id="expEndDate" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Active</label>
                    <select id="expActive" class="form-select">
                        <option value="1" selected>Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>
            <div class="modal-actions" style="margin-top:16px;">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('expenseModal').style.display='none'">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Expense</button>
            </div>
        </form>
    </div>
</div>

<!-- Record Payment Modal -->
<div id="paymentModal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
    <div class="modal">
        <div class="modal-header">
            <h2>Record Payment</h2>
            <button class="modal-close" onclick="document.getElementById('paymentModal').style.display='none'">&times;</button>
        </div>
        <form onsubmit="submitPayment(event)">
            <input type="hidden" id="payExpenseId">
            <div class="form-group">
                <label class="form-label">Amount Paid</label>
                <input type="number" id="payAmount" class="form-input" step="0.01" min="0" required placeholder="0.00">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Payment Date</label>
                    <input type="date" id="payDate" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <select id="payMethod" class="form-select">
                        <option value="Check">Check</option>
                        <option value="ACH">ACH</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Cash">Cash</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Reference #</label>
                <input type="text" id="payReference" class="form-input" placeholder="Check # or transaction ID">
            </div>
            <div class="form-group">
                <label class="form-label">Notes</label>
                <textarea id="payNotes" class="form-textarea" rows="2" placeholder="Optional notes..."></textarea>
            </div>
            <div class="modal-actions" style="margin-top:16px;">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('paymentModal').style.display='none'">Cancel</button>
                <button type="submit" class="btn btn-primary">Record Payment</button>
            </div>
        </form>
    </div>
</div>

<script src="/static/expenses.js"></script>
{% endblock %}
