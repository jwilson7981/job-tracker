{% extends "base.html" %}
{% block title %}Service Calls - Construction Management{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Service Calls</h1>
    <button class="btn btn-primary" onclick="showNewCall()">+ New Service Call</button>
</div>
<div class="filter-bar">
    <select id="filterStatus" onchange="loadCalls()">
        <option value="">All Statuses</option>
        <option value="Open">Open</option>
        <option value="Assigned">Assigned</option>
        <option value="In Progress">In Progress</option>
        <option value="Resolved">Resolved</option>
        <option value="Closed">Closed</option>
    </select>
    <select id="filterPriority" onchange="loadCalls()">
        <option value="">All Priorities</option>
        <option value="Urgent">Urgent</option>
        <option value="High">High</option>
        <option value="Normal">Normal</option>
        <option value="Low">Low</option>
    </select>
</div>
<div class="module-table-wrapper">
    <table class="data-table">
        <thead><tr>
            <th>#</th><th>Priority</th><th>Caller</th><th>Description</th><th>Job</th><th>Assigned To</th><th>Status</th><th>Date</th><th></th>
        </tr></thead>
        <tbody id="callsBody"><tr><td colspan="9" class="loading">Loading...</td></tr></tbody>
    </table>
</div>

<div id="callModal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
    <div class="modal">
        <h2>New Service Call</h2>
        <form onsubmit="saveCall(event)">
            <label>Caller Name</label><input type="text" id="scCaller" required>
            <label>Phone</label><input type="text" id="scPhone">
            <label>Email</label><input type="text" id="scEmail">
            <label>Description</label><textarea id="scDesc" required style="width:100%;padding:10px;border:1px solid var(--gray-300);border-radius:6px;min-height:80px;margin-bottom:16px;font-family:inherit;"></textarea>
            <label>Job (optional)</label>
            <select id="scJob" class="form-select"><option value="">None</option></select>
            <label>Priority</label>
            <select id="scPriority" class="form-select">
                <option value="Low">Low</option><option value="Normal" selected>Normal</option><option value="High">High</option><option value="Urgent">Urgent</option>
            </select>
            <label>Assigned To</label>
            <select id="scAssigned" class="form-select"><option value="">Unassigned</option></select>
            <label>Scheduled Date</label><input type="date" id="scScheduled">
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('callModal').style.display='none'">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>
<script src="/static/service_calls.js"></script>
{% endblock %}
