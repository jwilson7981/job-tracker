# Tax rate lookup for OK, AR, MO, KS, TX
# Out-of-state = not Oklahoma → adds $10,000 shipping fee (tax still applies)

# ─── Oklahoma (state 4.5% + local) ────────────────────────────
OK_RATES = {
    # Oklahoma City metro
    '73101': 8.625, '73102': 8.625, '73103': 8.625, '73104': 8.625,
    '73105': 8.625, '73106': 8.625, '73107': 8.625, '73108': 8.625,
    '73109': 8.625, '73110': 8.625, '73111': 8.625, '73112': 8.625,
    '73113': 8.625, '73114': 8.625, '73115': 8.625, '73116': 8.625,
    '73117': 8.625, '73118': 8.625, '73119': 8.625, '73120': 8.625,
    '73121': 8.625, '73122': 8.625, '73127': 8.625, '73128': 8.625,
    '73129': 8.625, '73130': 8.625, '73131': 8.625, '73132': 8.625,
    '73134': 8.625, '73135': 8.625, '73139': 8.625, '73141': 8.625,
    '73142': 8.625, '73145': 8.625, '73149': 8.625, '73150': 8.625,
    '73159': 8.625, '73160': 8.625, '73162': 8.625, '73169': 8.625,
    '73170': 8.625, '73173': 8.625,
    # Edmond
    '73003': 8.25, '73012': 8.25, '73013': 8.25, '73025': 8.25,
    '73034': 8.25, '73083': 8.25,
    # Norman
    '73019': 8.75, '73026': 8.75, '73068': 8.75, '73069': 8.75,
    '73070': 8.75, '73071': 8.75, '73072': 8.75,
    # Moore
    '73153': 9.0, '73165': 9.0,
    # Guthrie
    '73044': 9.5,
    # Midwest City
    '73110': 9.25, '73130': 9.25, '73140': 9.25, '73141': 9.25,
    # Yukon
    '73085': 9.25, '73099': 9.25,
    # Mustang
    '73064': 9.0,
    # Tulsa
    '74101': 8.517, '74102': 8.517, '74103': 8.517, '74104': 8.517,
    '74105': 8.517, '74106': 8.517, '74107': 8.517, '74108': 8.517,
    '74110': 8.517, '74112': 8.517, '74114': 8.517, '74115': 8.517,
    '74116': 8.517, '74117': 8.517, '74119': 8.517, '74120': 8.517,
    '74126': 8.517, '74127': 8.517, '74128': 8.517, '74129': 8.517,
    '74130': 8.517, '74131': 8.517, '74132': 8.517, '74133': 8.517,
    '74134': 8.517, '74135': 8.517, '74136': 8.517, '74137': 8.517,
    '74145': 8.517, '74146': 8.517,
    # Broken Arrow
    '74011': 9.35, '74012': 9.35, '74013': 9.35, '74014': 9.35,
    # Stillwater
    '74074': 9.0, '74075': 9.0, '74076': 9.0, '74078': 9.0,
    # Lawton
    '73501': 9.0, '73505': 9.0, '73506': 9.0, '73507': 9.0,
}
OK_DEFAULT = 8.625

# ─── Arkansas (state 6.5% + local) ────────────────────────────
AR_RATES = {
    # Little Rock
    '72201': 9.625, '72202': 9.625, '72204': 9.625, '72205': 9.625,
    '72206': 9.625, '72207': 9.625, '72209': 9.625, '72210': 9.625,
    '72211': 9.625, '72212': 9.625, '72223': 9.625, '72227': 9.625,
    # North Little Rock
    '72114': 9.5, '72116': 9.5, '72117': 9.5, '72118': 9.5,
    # Fort Smith
    '72901': 9.75, '72903': 9.75, '72904': 9.75, '72908': 9.75,
    # Fayetteville
    '72701': 9.75, '72703': 9.75, '72704': 9.75,
    # Springdale
    '72762': 9.75, '72764': 9.75,
    # Rogers
    '72756': 9.75, '72758': 9.75,
    # Bentonville
    '72712': 9.75, '72713': 9.75,
    # Jonesboro
    '72401': 9.875, '72404': 9.875,
    # Conway
    '72032': 9.5, '72034': 9.5, '72035': 9.5,
    # Pine Bluff
    '71601': 10.0, '71603': 10.0,
    # Hot Springs
    '71901': 9.5, '71913': 9.5,
}
AR_DEFAULT = 9.5

# ─── Missouri (state 4.225% + local) ──────────────────────────
MO_RATES = {
    # Kansas City
    '64101': 9.1, '64102': 9.1, '64105': 9.1, '64106': 9.1,
    '64108': 9.1, '64109': 9.1, '64110': 9.1, '64111': 9.1,
    '64112': 9.1, '64113': 9.1, '64114': 9.1, '64116': 9.1,
    '64117': 9.1, '64118': 9.1, '64119': 9.1, '64120': 9.1,
    '64123': 9.1, '64124': 9.1, '64125': 9.1, '64126': 9.1,
    '64127': 9.1, '64128': 9.1, '64129': 9.1, '64130': 9.1,
    '64131': 9.1, '64132': 9.1, '64133': 9.1, '64134': 9.1,
    '64137': 9.1, '64138': 9.1, '64139': 9.1, '64145': 9.1,
    '64146': 9.1, '64147': 9.1, '64149': 9.1, '64151': 9.1,
    '64152': 9.1, '64153': 9.1, '64154': 9.1, '64155': 9.1,
    '64156': 9.1, '64157': 9.1, '64158': 9.1,
    # St. Louis
    '63101': 9.679, '63102': 9.679, '63103': 9.679, '63104': 9.679,
    '63106': 9.679, '63107': 9.679, '63108': 9.679, '63109': 9.679,
    '63110': 9.679, '63111': 9.679, '63112': 9.679, '63113': 9.679,
    '63116': 9.679, '63118': 9.679, '63120': 9.679, '63139': 9.679,
    # Springfield
    '65801': 8.1, '65802': 8.1, '65803': 8.1, '65804': 8.1,
    '65806': 8.1, '65807': 8.1, '65809': 8.1, '65810': 8.1,
    # Columbia
    '65201': 8.975, '65202': 8.975, '65203': 8.975,
    # Independence
    '64050': 9.35, '64052': 9.35, '64054': 9.35, '64055': 9.35,
    '64056': 9.35, '64057': 9.35, '64058': 9.35,
    # Joplin
    '64801': 8.95, '64804': 8.95,
    # Lee's Summit
    '64063': 8.975, '64064': 8.975, '64081': 8.975, '64082': 8.975,
    # St. Joseph
    '64501': 8.7, '64503': 8.7, '64504': 8.7, '64506': 8.7,
    # O'Fallon
    '63366': 8.95, '63368': 8.95,
}
MO_DEFAULT = 8.6

# ─── Kansas (state 6.5% + local) ──────────────────────────────
KS_RATES = {
    # Wichita
    '67201': 7.5, '67202': 7.5, '67203': 7.5, '67204': 7.5,
    '67205': 7.5, '67206': 7.5, '67207': 7.5, '67208': 7.5,
    '67209': 7.5, '67210': 7.5, '67211': 7.5, '67212': 7.5,
    '67213': 7.5, '67214': 7.5, '67215': 7.5, '67216': 7.5,
    '67217': 7.5, '67218': 7.5, '67219': 7.5, '67220': 7.5,
    '67226': 7.5, '67228': 7.5, '67230': 7.5, '67235': 7.5,
    # Overland Park
    '66204': 10.1, '66207': 10.1, '66209': 10.1, '66210': 10.1,
    '66211': 10.1, '66212': 10.1, '66213': 10.1, '66214': 10.1,
    '66221': 10.1, '66223': 10.1, '66224': 10.1,
    # Kansas City KS
    '66101': 9.125, '66102': 9.125, '66103': 9.125, '66104': 9.125,
    '66105': 9.125, '66106': 9.125, '66109': 9.125, '66111': 9.125,
    '66112': 9.125, '66115': 9.125, '66118': 9.125,
    # Olathe
    '66061': 9.475, '66062': 9.475,
    # Topeka
    '66601': 9.35, '66603': 9.35, '66604': 9.35, '66605': 9.35,
    '66606': 9.35, '66607': 9.35, '66608': 9.35, '66609': 9.35,
    '66610': 9.35, '66611': 9.35, '66612': 9.35, '66614': 9.35,
    '66615': 9.35, '66616': 9.35, '66617': 9.35, '66618': 9.35,
    '66619': 9.35,
    # Lawrence
    '66044': 9.3, '66045': 9.3, '66046': 9.3, '66047': 9.3,
    # Manhattan
    '66502': 9.15, '66503': 9.15,
    # Lenexa
    '66215': 9.35, '66219': 9.35, '66220': 9.35, '66227': 9.35,
}
KS_DEFAULT = 8.75

# ─── Texas (state 6.25% + local) ──────────────────────────────
TX_RATES = {
    # Dallas
    '75201': 8.25, '75202': 8.25, '75203': 8.25, '75204': 8.25,
    '75205': 8.25, '75206': 8.25, '75207': 8.25, '75208': 8.25,
    '75209': 8.25, '75210': 8.25, '75211': 8.25, '75212': 8.25,
    '75214': 8.25, '75215': 8.25, '75216': 8.25, '75217': 8.25,
    '75218': 8.25, '75219': 8.25, '75220': 8.25, '75223': 8.25,
    '75224': 8.25, '75225': 8.25, '75226': 8.25, '75227': 8.25,
    '75228': 8.25, '75229': 8.25, '75230': 8.25, '75231': 8.25,
    '75232': 8.25, '75233': 8.25, '75234': 8.25, '75235': 8.25,
    '75236': 8.25, '75237': 8.25, '75238': 8.25, '75240': 8.25,
    '75241': 8.25, '75243': 8.25, '75244': 8.25, '75246': 8.25,
    '75247': 8.25, '75248': 8.25, '75249': 8.25, '75251': 8.25,
    '75252': 8.25, '75253': 8.25, '75254': 8.25,
    # Houston
    '77001': 8.25, '77002': 8.25, '77003': 8.25, '77004': 8.25,
    '77005': 8.25, '77006': 8.25, '77007': 8.25, '77008': 8.25,
    '77009': 8.25, '77010': 8.25, '77011': 8.25, '77012': 8.25,
    '77019': 8.25, '77020': 8.25, '77021': 8.25, '77022': 8.25,
    '77023': 8.25, '77024': 8.25, '77025': 8.25, '77026': 8.25,
    '77027': 8.25, '77028': 8.25, '77029': 8.25, '77030': 8.25,
    '77031': 8.25, '77033': 8.25, '77034': 8.25, '77035': 8.25,
    '77036': 8.25, '77038': 8.25, '77040': 8.25, '77041': 8.25,
    '77042': 8.25, '77043': 8.25, '77045': 8.25, '77047': 8.25,
    '77048': 8.25, '77049': 8.25, '77050': 8.25, '77051': 8.25,
    '77053': 8.25, '77054': 8.25, '77055': 8.25, '77056': 8.25,
    '77057': 8.25, '77058': 8.25, '77059': 8.25, '77060': 8.25,
    '77061': 8.25, '77062': 8.25, '77063': 8.25, '77064': 8.25,
    '77065': 8.25, '77066': 8.25, '77067': 8.25, '77068': 8.25,
    '77069': 8.25, '77070': 8.25, '77071': 8.25, '77072': 8.25,
    '77073': 8.25, '77074': 8.25, '77075': 8.25, '77076': 8.25,
    '77077': 8.25, '77078': 8.25, '77079': 8.25, '77080': 8.25,
    '77081': 8.25, '77082': 8.25, '77083': 8.25, '77084': 8.25,
    '77085': 8.25, '77086': 8.25, '77087': 8.25, '77088': 8.25,
    '77089': 8.25, '77090': 8.25, '77091': 8.25, '77092': 8.25,
    '77093': 8.25, '77094': 8.25, '77095': 8.25, '77096': 8.25,
    '77098': 8.25, '77099': 8.25,
    # Fort Worth
    '76101': 8.25, '76102': 8.25, '76103': 8.25, '76104': 8.25,
    '76105': 8.25, '76106': 8.25, '76107': 8.25, '76108': 8.25,
    '76109': 8.25, '76110': 8.25, '76111': 8.25, '76112': 8.25,
    '76114': 8.25, '76115': 8.25, '76116': 8.25, '76117': 8.25,
    '76118': 8.25, '76119': 8.25, '76120': 8.25, '76123': 8.25,
    '76126': 8.25, '76129': 8.25, '76131': 8.25, '76132': 8.25,
    '76133': 8.25, '76134': 8.25, '76135': 8.25, '76137': 8.25,
    '76140': 8.25, '76148': 8.25, '76155': 8.25, '76164': 8.25,
    # San Antonio
    '78201': 8.25, '78202': 8.25, '78203': 8.25, '78204': 8.25,
    '78205': 8.25, '78207': 8.25, '78208': 8.25, '78209': 8.25,
    '78210': 8.25, '78211': 8.25, '78212': 8.25, '78213': 8.25,
    '78214': 8.25, '78215': 8.25, '78216': 8.25, '78217': 8.25,
    '78218': 8.25, '78219': 8.25, '78220': 8.25, '78221': 8.25,
    '78222': 8.25, '78223': 8.25, '78224': 8.25, '78225': 8.25,
    '78226': 8.25, '78227': 8.25, '78228': 8.25, '78229': 8.25,
    '78230': 8.25, '78231': 8.25, '78232': 8.25, '78233': 8.25,
    '78234': 8.25, '78235': 8.25, '78236': 8.25, '78237': 8.25,
    '78238': 8.25, '78239': 8.25, '78240': 8.25, '78242': 8.25,
    '78244': 8.25, '78245': 8.25, '78247': 8.25, '78248': 8.25,
    '78249': 8.25, '78250': 8.25, '78251': 8.25, '78252': 8.25,
    '78253': 8.25, '78254': 8.25, '78255': 8.25, '78256': 8.25,
    '78257': 8.25, '78258': 8.25, '78259': 8.25, '78260': 8.25,
    '78261': 8.25, '78263': 8.25, '78264': 8.25,
    # Austin
    '78701': 8.25, '78702': 8.25, '78703': 8.25, '78704': 8.25,
    '78705': 8.25, '78712': 8.25, '78717': 8.25, '78719': 8.25,
    '78721': 8.25, '78722': 8.25, '78723': 8.25, '78724': 8.25,
    '78725': 8.25, '78726': 8.25, '78727': 8.25, '78728': 8.25,
    '78729': 8.25, '78730': 8.25, '78731': 8.25, '78732': 8.25,
    '78733': 8.25, '78734': 8.25, '78735': 8.25, '78736': 8.25,
    '78737': 8.25, '78738': 8.25, '78739': 8.25, '78741': 8.25,
    '78744': 8.25, '78745': 8.25, '78746': 8.25, '78747': 8.25,
    '78748': 8.25, '78749': 8.25, '78750': 8.25, '78751': 8.25,
    '78752': 8.25, '78753': 8.25, '78754': 8.25, '78756': 8.25,
    '78757': 8.25, '78758': 8.25, '78759': 8.25,
    # El Paso
    '79901': 8.25, '79902': 8.25, '79903': 8.25, '79904': 8.25,
    '79905': 8.25, '79907': 8.25, '79911': 8.25, '79912': 8.25,
    '79915': 8.25, '79922': 8.25, '79924': 8.25, '79925': 8.25,
    '79927': 8.25, '79928': 8.25, '79930': 8.25, '79932': 8.25,
    '79934': 8.25, '79935': 8.25, '79936': 8.25, '79938': 8.25,
    # McKinney / Allen / Plano area (75xxx)
    '75001': 8.25, '75002': 8.25, '75013': 8.25, '75023': 8.25,
    '75024': 8.25, '75025': 8.25, '75034': 8.25, '75035': 8.25,
    '75069': 8.25, '75070': 8.25, '75071': 8.25, '75074': 8.25,
    '75075': 8.25, '75078': 8.25, '75080': 8.25, '75081': 8.25,
    '75082': 8.25, '75093': 8.25,
}
TX_DEFAULT = 8.25

# ─── Zip prefix → state mapping ───────────────────────────────
# OK: 73xxx, 74xxx
# AR: 716xx, 717xx, 718xx, 719xx, 720xx-729xx
# MO: 630xx-651xx, 63xxx, 64xxx, 65xxx
# KS: 660xx-679xx, 66xxx, 67xxx
# TX: 75xxx-79xxx, 73301 (Austin)

ZIP_STATE_MAP = {
    'OK': lambda z: z[:2] in ('73', '74'),
    'AR': lambda z: z[:2] in ('71', '72'),
    'MO': lambda z: z[:2] in ('63', '64', '65'),
    'KS': lambda z: z[:2] in ('66', '67'),
    'TX': lambda z: z[:2] in ('75', '76', '77', '78', '79'),
}

STATE_RATES = {
    'OK': (OK_RATES, OK_DEFAULT),
    'AR': (AR_RATES, AR_DEFAULT),
    'MO': (MO_RATES, MO_DEFAULT),
    'KS': (KS_RATES, KS_DEFAULT),
    'TX': (TX_RATES, TX_DEFAULT),
}

# ─── City name lookup ─────────────────────────────────────────
ZIP_CITY_MAP = {
    # Oklahoma
    '73101': 'Oklahoma City', '73102': 'Oklahoma City', '73103': 'Oklahoma City',
    '73104': 'Oklahoma City', '73105': 'Oklahoma City', '73106': 'Oklahoma City',
    '73107': 'Oklahoma City', '73108': 'Oklahoma City', '73109': 'Oklahoma City',
    '73110': 'Midwest City', '73111': 'Oklahoma City', '73112': 'Oklahoma City',
    '73113': 'Oklahoma City', '73114': 'Oklahoma City', '73115': 'Oklahoma City',
    '73116': 'Oklahoma City', '73117': 'Oklahoma City', '73118': 'Oklahoma City',
    '73119': 'Oklahoma City', '73120': 'Oklahoma City', '73121': 'Oklahoma City',
    '73122': 'Oklahoma City', '73127': 'Oklahoma City', '73128': 'Oklahoma City',
    '73129': 'Oklahoma City', '73130': 'Midwest City', '73131': 'Oklahoma City',
    '73132': 'Oklahoma City', '73134': 'Oklahoma City', '73135': 'Oklahoma City',
    '73139': 'Oklahoma City', '73140': 'Midwest City', '73141': 'Midwest City',
    '73142': 'Oklahoma City', '73145': 'Oklahoma City', '73149': 'Oklahoma City',
    '73150': 'Oklahoma City', '73153': 'Moore', '73159': 'Oklahoma City',
    '73160': 'Moore', '73162': 'Oklahoma City', '73165': 'Moore',
    '73169': 'Oklahoma City', '73170': 'Oklahoma City', '73173': 'Oklahoma City',
    '73003': 'Edmond', '73012': 'Edmond', '73013': 'Edmond', '73025': 'Edmond',
    '73034': 'Edmond', '73083': 'Edmond',
    '73019': 'Norman', '73026': 'Norman', '73068': 'Norman', '73069': 'Norman',
    '73070': 'Norman', '73071': 'Norman', '73072': 'Norman',
    '73044': 'Guthrie',
    '73085': 'Yukon', '73099': 'Yukon',
    '73064': 'Mustang',
    '74101': 'Tulsa', '74102': 'Tulsa', '74103': 'Tulsa', '74104': 'Tulsa',
    '74105': 'Tulsa', '74106': 'Tulsa', '74107': 'Tulsa', '74108': 'Tulsa',
    '74110': 'Tulsa', '74112': 'Tulsa', '74114': 'Tulsa', '74115': 'Tulsa',
    '74116': 'Tulsa', '74117': 'Tulsa', '74119': 'Tulsa', '74120': 'Tulsa',
    '74126': 'Tulsa', '74127': 'Tulsa', '74128': 'Tulsa', '74129': 'Tulsa',
    '74130': 'Tulsa', '74131': 'Tulsa', '74132': 'Tulsa', '74133': 'Tulsa',
    '74134': 'Tulsa', '74135': 'Tulsa', '74136': 'Tulsa', '74137': 'Tulsa',
    '74145': 'Tulsa', '74146': 'Tulsa',
    '74011': 'Broken Arrow', '74012': 'Broken Arrow', '74013': 'Broken Arrow',
    '74014': 'Broken Arrow',
    '74074': 'Stillwater', '74075': 'Stillwater', '74076': 'Stillwater',
    '74078': 'Stillwater',
    '73501': 'Lawton', '73505': 'Lawton', '73506': 'Lawton', '73507': 'Lawton',
    # Arkansas
    '72201': 'Little Rock', '72202': 'Little Rock', '72204': 'Little Rock',
    '72205': 'Little Rock', '72206': 'Little Rock', '72207': 'Little Rock',
    '72209': 'Little Rock', '72210': 'Little Rock', '72211': 'Little Rock',
    '72212': 'Little Rock', '72223': 'Little Rock', '72227': 'Little Rock',
    '72114': 'North Little Rock', '72116': 'North Little Rock',
    '72117': 'North Little Rock', '72118': 'North Little Rock',
    '72901': 'Fort Smith', '72903': 'Fort Smith', '72904': 'Fort Smith',
    '72908': 'Fort Smith',
    '72701': 'Fayetteville', '72703': 'Fayetteville', '72704': 'Fayetteville',
    '72762': 'Springdale', '72764': 'Springdale',
    '72756': 'Rogers', '72758': 'Rogers',
    '72712': 'Bentonville', '72713': 'Bentonville',
    '72401': 'Jonesboro', '72404': 'Jonesboro',
    '72032': 'Conway', '72034': 'Conway', '72035': 'Conway',
    '71601': 'Pine Bluff', '71603': 'Pine Bluff',
    '71901': 'Hot Springs', '71913': 'Hot Springs',
    # Missouri
    '64101': 'Kansas City', '64102': 'Kansas City', '64105': 'Kansas City',
    '64106': 'Kansas City', '64108': 'Kansas City', '64109': 'Kansas City',
    '64110': 'Kansas City', '64111': 'Kansas City', '64112': 'Kansas City',
    '64113': 'Kansas City', '64114': 'Kansas City', '64116': 'Kansas City',
    '64117': 'Kansas City', '64118': 'Kansas City', '64119': 'Kansas City',
    '64120': 'Kansas City', '64123': 'Kansas City', '64124': 'Kansas City',
    '64125': 'Kansas City', '64126': 'Kansas City', '64127': 'Kansas City',
    '64128': 'Kansas City', '64129': 'Kansas City', '64130': 'Kansas City',
    '64131': 'Kansas City', '64132': 'Kansas City', '64133': 'Kansas City',
    '64134': 'Kansas City', '64137': 'Kansas City', '64138': 'Kansas City',
    '64139': 'Kansas City', '64145': 'Kansas City', '64146': 'Kansas City',
    '64147': 'Kansas City', '64149': 'Kansas City', '64151': 'Kansas City',
    '64152': 'Kansas City', '64153': 'Kansas City', '64154': 'Kansas City',
    '64155': 'Kansas City', '64156': 'Kansas City', '64157': 'Kansas City',
    '64158': 'Kansas City',
    '63101': 'St. Louis', '63102': 'St. Louis', '63103': 'St. Louis',
    '63104': 'St. Louis', '63106': 'St. Louis', '63107': 'St. Louis',
    '63108': 'St. Louis', '63109': 'St. Louis', '63110': 'St. Louis',
    '63111': 'St. Louis', '63112': 'St. Louis', '63113': 'St. Louis',
    '63116': 'St. Louis', '63118': 'St. Louis', '63120': 'St. Louis',
    '63139': 'St. Louis',
    '65801': 'Springfield', '65802': 'Springfield', '65803': 'Springfield',
    '65804': 'Springfield', '65806': 'Springfield', '65807': 'Springfield',
    '65809': 'Springfield', '65810': 'Springfield',
    '65201': 'Columbia', '65202': 'Columbia', '65203': 'Columbia',
    '64050': 'Independence', '64052': 'Independence', '64054': 'Independence',
    '64055': 'Independence', '64056': 'Independence', '64057': 'Independence',
    '64058': 'Independence',
    '64801': 'Joplin', '64804': 'Joplin',
    '64063': "Lee's Summit", '64064': "Lee's Summit",
    '64081': "Lee's Summit", '64082': "Lee's Summit",
    '64501': 'St. Joseph', '64503': 'St. Joseph', '64504': 'St. Joseph',
    '64506': 'St. Joseph',
    '63366': "O'Fallon", '63368': "O'Fallon",
    # Kansas
    '67201': 'Wichita', '67202': 'Wichita', '67203': 'Wichita',
    '67204': 'Wichita', '67205': 'Wichita', '67206': 'Wichita',
    '67207': 'Wichita', '67208': 'Wichita', '67209': 'Wichita',
    '67210': 'Wichita', '67211': 'Wichita', '67212': 'Wichita',
    '67213': 'Wichita', '67214': 'Wichita', '67215': 'Wichita',
    '67216': 'Wichita', '67217': 'Wichita', '67218': 'Wichita',
    '67219': 'Wichita', '67220': 'Wichita', '67226': 'Wichita',
    '67228': 'Wichita', '67230': 'Wichita', '67235': 'Wichita',
    '66204': 'Overland Park', '66207': 'Overland Park', '66209': 'Overland Park',
    '66210': 'Overland Park', '66211': 'Overland Park', '66212': 'Overland Park',
    '66213': 'Overland Park', '66214': 'Overland Park', '66221': 'Overland Park',
    '66223': 'Overland Park', '66224': 'Overland Park',
    '66101': 'Kansas City', '66102': 'Kansas City', '66103': 'Kansas City',
    '66104': 'Kansas City', '66105': 'Kansas City', '66106': 'Kansas City',
    '66109': 'Kansas City', '66111': 'Kansas City', '66112': 'Kansas City',
    '66115': 'Kansas City', '66118': 'Kansas City',
    '66061': 'Olathe', '66062': 'Olathe',
    '66601': 'Topeka', '66603': 'Topeka', '66604': 'Topeka', '66605': 'Topeka',
    '66606': 'Topeka', '66607': 'Topeka', '66608': 'Topeka', '66609': 'Topeka',
    '66610': 'Topeka', '66611': 'Topeka', '66612': 'Topeka', '66614': 'Topeka',
    '66615': 'Topeka', '66616': 'Topeka', '66617': 'Topeka', '66618': 'Topeka',
    '66619': 'Topeka',
    '66044': 'Lawrence', '66045': 'Lawrence', '66046': 'Lawrence', '66047': 'Lawrence',
    '66502': 'Manhattan', '66503': 'Manhattan',
    '66215': 'Lenexa', '66219': 'Lenexa', '66220': 'Lenexa', '66227': 'Lenexa',
    # Texas
    '75001': 'Addison', '75002': 'Allen', '75013': 'Allen',
    '75023': 'Plano', '75024': 'Plano', '75025': 'Plano',
    '75034': 'Frisco', '75035': 'Frisco',
    '75069': 'McKinney', '75070': 'McKinney', '75071': 'McKinney',
    '75074': 'Plano', '75075': 'Plano', '75078': 'Prosper',
    '75080': 'Richardson', '75081': 'Richardson', '75082': 'Richardson',
    '75093': 'Plano',
    '75201': 'Dallas', '75202': 'Dallas', '75203': 'Dallas', '75204': 'Dallas',
    '75205': 'Dallas', '75206': 'Dallas', '75207': 'Dallas', '75208': 'Dallas',
    '75209': 'Dallas', '75210': 'Dallas', '75211': 'Dallas', '75212': 'Dallas',
    '75214': 'Dallas', '75215': 'Dallas', '75216': 'Dallas', '75217': 'Dallas',
    '75218': 'Dallas', '75219': 'Dallas', '75220': 'Dallas', '75223': 'Dallas',
    '75224': 'Dallas', '75225': 'Dallas', '75226': 'Dallas', '75227': 'Dallas',
    '75228': 'Dallas', '75229': 'Dallas', '75230': 'Dallas', '75231': 'Dallas',
    '75232': 'Dallas', '75233': 'Dallas', '75234': 'Dallas', '75235': 'Dallas',
    '75236': 'Dallas', '75237': 'Dallas', '75238': 'Dallas', '75240': 'Dallas',
    '75241': 'Dallas', '75243': 'Dallas', '75244': 'Dallas', '75246': 'Dallas',
    '75247': 'Dallas', '75248': 'Dallas', '75249': 'Dallas', '75251': 'Dallas',
    '75252': 'Dallas', '75253': 'Dallas', '75254': 'Dallas',
    '77001': 'Houston', '77002': 'Houston', '77003': 'Houston', '77004': 'Houston',
    '77005': 'Houston', '77006': 'Houston', '77007': 'Houston', '77008': 'Houston',
    '77009': 'Houston', '77010': 'Houston', '77019': 'Houston', '77020': 'Houston',
    '77030': 'Houston', '77040': 'Houston', '77056': 'Houston', '77077': 'Houston',
    '76101': 'Fort Worth', '76102': 'Fort Worth', '76103': 'Fort Worth',
    '76104': 'Fort Worth', '76107': 'Fort Worth', '76109': 'Fort Worth',
    '76110': 'Fort Worth', '76116': 'Fort Worth', '76132': 'Fort Worth',
    '78201': 'San Antonio', '78202': 'San Antonio', '78204': 'San Antonio',
    '78205': 'San Antonio', '78209': 'San Antonio', '78210': 'San Antonio',
    '78212': 'San Antonio', '78216': 'San Antonio', '78229': 'San Antonio',
    '78240': 'San Antonio', '78245': 'San Antonio', '78250': 'San Antonio',
    '78701': 'Austin', '78702': 'Austin', '78703': 'Austin', '78704': 'Austin',
    '78705': 'Austin', '78731': 'Austin', '78745': 'Austin', '78748': 'Austin',
    '78751': 'Austin', '78758': 'Austin', '78759': 'Austin',
    '79901': 'El Paso', '79902': 'El Paso', '79912': 'El Paso',
    '79925': 'El Paso', '79936': 'El Paso',
}


def lookup_tax(zip_code):
    """Look up tax info for a zip code.

    Returns dict with: state, city, tax_rate, out_of_state
    - Recognized state zips (OK/AR/MO/KS/TX): returns rate from table or state default
    - out_of_state = True for anything outside Oklahoma (shipping fee applies)
    - Tax rate is always returned based on job site location
    """
    zip_code = (zip_code or '').strip()[:5]

    if not zip_code or len(zip_code) < 5:
        return {'state': '', 'city': '', 'tax_rate': 0, 'out_of_state': False}

    # Determine which state this zip belongs to
    matched_state = None
    for state_abbr, check_fn in ZIP_STATE_MAP.items():
        if check_fn(zip_code):
            matched_state = state_abbr
            break

    if matched_state:
        rates_dict, default_rate = STATE_RATES[matched_state]
        rate = rates_dict.get(zip_code, default_rate)
        city = ZIP_CITY_MAP.get(zip_code, '')
        return {
            'state': matched_state,
            'city': city,
            'tax_rate': rate,
            'out_of_state': matched_state != 'OK',
        }
    else:
        # Unknown state — still out of state, no known tax rate
        return {
            'state': '',
            'city': '',
            'tax_rate': 0,
            'out_of_state': True,
        }
